<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Streaming and async APIs • elmer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Streaming and async APIs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">elmer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/streaming-async.html">Streaming and async APIs</a></li>
    <li><a class="dropdown-item" href="../articles/tool-calling.html">Tool calling (a.k.a. function calling)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hadley/elmer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Streaming and async APIs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hadley/elmer/blob/main/vignettes/streaming-async.Rmd" class="external-link"><code>vignettes/streaming-async.Rmd</code></a></small>
      <div class="d-none name"><code>streaming-async.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="streaming-results">Streaming results<a class="anchor" aria-label="anchor" href="#streaming-results"></a>
</h3>
<p>The <code>chat()</code> method does not return any results until the
entire response has been received. (It can <em>print</em> the streaming
results to the console, but it <em>returns</em> the result only when the
response is complete.)</p>
<p>If you want to process the response as it arrives, you can use the
<code>stream()</code> method. This may be useful when you want to
display the response in realtime, but somewhere other than the R console
(like writing to a file, or an HTTP response, or a Shiny chat window);
or when you want to manipulate the response before displaying it,
without giving up the immediacy of streaming.</p>
<p>The <code>stream()</code> method returns a <a href="https://coro.r-lib.org/articles/generator.html" class="external-link">generator</a> from
the <a href="https://coro.r-lib.org/" class="external-link">coro package</a>, which you can
loop over to process the response as it arrives.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="va">chat</span><span class="op">$</span><span class="fu">stream</span><span class="op">(</span><span class="st">"What are some common uses of R?"</span><span class="op">)</span></span>
<span><span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/collect.html" class="external-link">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">chunk</span> <span class="kw">in</span> <span class="va">stream</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;  R IS COMMONLY USED FOR:</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;  1. **STATISTICAL ANALYSIS**: PERFORMING COMPLEX STATISTICAL TESTS AND ANALYSES.</span></span>
<span><span class="co">#&gt;  2. **DATA VISUALIZATION**: CREATING GRAPHS, CHARTS, AND PLOTS USING PACKAGES LIKE  GGPLOT2.</span></span>
<span><span class="co">#&gt;  3. **DATA MANIPULATION**: CLEANING AND TRANSFORMING DATA WITH PACKAGES LIKE DPLYR AND TIDYR.</span></span>
<span><span class="co">#&gt;  4. **MACHINE LEARNING**: BUILDING PREDICTIVE MODELS WITH LIBRARIES LIKE CARET AND #&gt;  RANDOMFOREST.</span></span>
<span><span class="co">#&gt;  5. **BIOINFORMATICS**: ANALYZING BIOLOGICAL DATA AND GENOMIC STUDIES.</span></span>
<span><span class="co">#&gt;  6. **ECONOMETRICS**: PERFORMING ECONOMIC DATA ANALYSIS AND MODELING.</span></span>
<span><span class="co">#&gt;  7. **REPORTING**: GENERATING DYNAMIC REPORTS AND DASHBOARDS WITH R MARKDOWN.</span></span>
<span><span class="co">#&gt;  8. **TIME SERIES ANALYSIS**: ANALYZING TEMPORAL DATA AND FORECASTING.</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;  THESE USES MAKE R A POWERFUL TOOL FOR DATA SCIENTISTS, STATISTICIANS, AND RESEARCHERS.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="async-usage">Async usage<a class="anchor" aria-label="anchor" href="#async-usage"></a>
</h2>
<p>elmer also supports async usage, which is useful when you want to run
multiple chat sessions concurrently. This is primarily useful in Shiny
applications, where using the methods described above would block the
Shiny app for other users for the duration of each response.</p>
<p>To use async chat, instead of
<code>chat()</code>/<code>stream()</code>, call
<code>chat_async()</code>/<code>stream_async()</code>. The
<code>_async</code> variants take the same arguments for construction,
but return promises instead of the actual response.</p>
<p>Remember that chat objects are stateful, maintaining the conversation
history as you interact with it. Note that this means it doesn’t make
sense to issue multiple chat/stream operations on the same chat object
concurrently, as the conversation history could become corrupted with
interleaved conversation fragments. If you need to run multiple chat
sessions concurrently, create multiple chat objects.</p>
<div class="section level3">
<h3 id="asynchronous-chat">Asynchronous chat<a class="anchor" aria-label="anchor" href="#asynchronous-chat"></a>
</h3>
<p>For asynchronous, non-streaming chat, you use the <code>chat()</code>
method as before, but handle the result as a promise instead of a
string.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat_async</span><span class="op">(</span><span class="st">"How's your day going?"</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; I'm just a computer program, so I don't have feelings, but I'm here to help you with any questions you have.</span></span></code></pre></div>
<p>TODO: Shiny example</p>
</div>
<div class="section level3">
<h3 id="asynchronous-streaming">Asynchronous streaming<a class="anchor" aria-label="anchor" href="#asynchronous-streaming"></a>
</h3>
<p>For asynchronous streaming, you use the <code>stream()</code> method
as before, but the result is a <a href="https://coro.r-lib.org/reference/async_generator.html" class="external-link">async
generator</a> from the <a href="https://coro.r-lib.org/" class="external-link">coro
package</a>. This is the same as a regular <a href="https://coro.r-lib.org/articles/generator.html" class="external-link">generator</a>,
except instead of giving you strings, it gives you promises that resolve
to strings.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="va">chat</span><span class="op">$</span><span class="fu">stream_async</span><span class="op">(</span><span class="st">"What are some common uses of R?"</span><span class="op">)</span></span>
<span><span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coro/man/async.html" class="external-link">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">chunk</span> <span class="kw">in</span> <span class="fu">await_each</span><span class="op">(</span><span class="va">stream</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  R IS COMMONLY USED FOR:</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt;  1. **STATISTICAL ANALYSIS**: PERFORMING VARIOUS STATISTICAL TESTS AND MODELS.</span></span>
<span><span class="co">#&gt;  2. **DATA VISUALIZATION**: CREATING PLOTS AND GRAPHS TO VISUALIZE DATA.</span></span>
<span><span class="co">#&gt;  3. **DATA MANIPULATION**: CLEANING AND TRANSFORMING DATA WITH PACKAGES LIKE DPLYR.</span></span>
<span><span class="co">#&gt;  4. **MACHINE LEARNING**: BUILDING PREDICTIVE MODELS AND ALGORITHMS.</span></span>
<span><span class="co">#&gt;  5. **BIOINFORMATICS**: ANALYZING BIOLOGICAL DATA, ESPECIALLY IN GENOMICS.</span></span>
<span><span class="co">#&gt;  6. **TIME SERIES ANALYSIS**: ANALYZING TEMPORAL DATA FOR TRENDS AND FORECASTS.</span></span>
<span><span class="co">#&gt;  7. **REPORT GENERATION**: CREATING DYNAMIC REPORTS WITH R MARKDOWN.</span></span>
<span><span class="co">#&gt;  8. **GEOSPATIAL ANALYSIS**: MAPPING AND ANALYZING GEOGRAPHIC DATA.</span></span></code></pre></div>
<p>Async generators are very advanced, and require a good understanding
of asynchronous programming in R. They are also the only way to present
streaming results in Shiny without blocking other users. Fortunately,
Shiny will soon have chat components that will make this easier, where
you can simply hand the result of <code>stream_async()</code> to a chat
output.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hadley Wickham, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
